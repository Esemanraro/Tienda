{% extends 'base.html' %}

{% block title %}Gestión de Inventario{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="admin-header">
        <h1>Gestión de Inventario</h1>
        <div class="admin-actions">
            <button class="admin-btn" onclick="showAddToyModal()">
                <i class="fas fa-plus"></i> Agregar Juguete
            </button>
        </div>
    </div>

    <!-- Filtros y Búsqueda -->
    <div class="filter-section">
        <input type="text" id="toySearch" placeholder="Buscar juguetes..." class="search-input">
        <select id="categoryFilter" class="filter-select">
            <option value="all">Todas las categorías</option>
            {% for value, label in toy_form.category.choices %}
            <option value="{{ value }}">{{ label }}</option>
            {% endfor %}
        </select>
    </div>

    <!-- Grid de Juguetes -->
    <div class="toys-grid">
        {% for toy in toys %}
        <div class="toy-card">
            <div class="toy-image">
                <img src="{{ toy.image_url }}" alt="{{ toy.name }}">
                <div class="toy-actions">
                    <button class="action-btn edit" onclick="showEditToyModal('{{ toy.id }}')">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="action-btn delete" onclick="showDeleteToyModal('{{ toy.id }}')">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
            <div class="toy-info">
                <h3>{{ toy.name }}</h3>
                <p class="toy-price">{{ toy.price }} ALOHA Dólares</p>
                <p class="toy-category">{{ toy.category }}</p>
                <p class="toy-description">{{ toy.description }}</p>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Modal Agregar Juguete -->
    <div id="addToyModal" class="modal">
        <div class="modal-content">
            <h2>Agregar Juguete</h2>
            <form id="addToyForm" enctype="multipart/form-data">
                {{ toy_form.hidden_tag() }}
                <div class="form-group">
                    <label for="toyName">Nombre del Juguete</label>
                    <input type="text" id="toyName" name="name" required>
                </div>
                <div class="form-group">
                    <label for="toyDescription">Descripción</label>
                    <textarea id="toyDescription" name="description" required></textarea>
                </div>
                <div class="form-group">
                    <label for="toyPrice">Precio (ALOHA Dólares)</label>
                    <input type="number" id="toyPrice" name="price" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="toyStock">Stock</label>
                    <input type="number" id="toyStock" name="stock" min="0" required>
                </div>
                <div class="form-group">
                    <label for="toyCategory">Categoría de Edad</label>
                    {{ toy_form.category(id='toyCategory') }}
                </div>
                <div class="form-group">
                    <label for="toyImage">Imagen</label>
                    <input type="file" id="toyImage" name="image" accept="image/*" required>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn-primary">Guardar</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('addToyModal')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
.admin-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem;
}

.toys-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-top: 2rem;
}

.toy-card {
    background: var(--card-bg);
    border-radius: 10px;
    overflow: hidden;
    box-shadow: var(--box-shadow);
    transition: transform 0.2s;
}

.toy-card:hover {
    transform: translateY(-5px);
}

.toy-image {
    position: relative;
    padding-top: 75%;
}

.toy-image img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.toy-actions {
    position: absolute;
    top: 10px;
    right: 10px;
    display: flex;
    gap: 0.5rem;
}

.toy-info {
    padding: 1rem;
}

.toy-info h3 {
    margin: 0;
    font-size: 1.2rem;
    color: var(--primary-color);
}

.toy-price {
    font-weight: bold;
    color: var(--secondary-color);
}

.toy-category {
    font-size: 0.9rem;
    color: var(--text-color);
    opacity: 0.8;
}

.toy-description {
    font-size: 0.9rem;
    margin-top: 0.5rem;
    color: var(--text-color);
}

.form-group textarea {
    width: 100%;
    min-height: 100px;
    padding: 0.5rem;
    border: 1px solid var(--border-color);
    border-radius: 5px;
    background: var(--input-bg);
    color: var(--text-color);
    resize: vertical;
}

.form-group input[type="file"] {
    padding: 0.5rem;
    border: 1px solid var(--border-color);
    border-radius: 5px;
    background: var(--input-bg);
    color: var(--text-color);
    width: 100%;
}
</style>

<script>
function showAddToyModal() {
    document.getElementById('addToyModal').style.display = 'block';
}

function closeModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
}

// Manejo del formulario de agregar juguete
document.getElementById('addToyForm').onsubmit = async function(e) {
    e.preventDefault();
    const formData = new FormData(this);
    formData.set('stock', document.getElementById('toyStock').value);
    formData.set('csrf_token', document.querySelector('input[name="csrf_token"]').value);
    try {
        const response = await fetch('/admin/toys/add', {
            method: 'POST',
            body: formData
        });
        if (response.ok) {
            closeModal('addToyModal');
            location.reload();
        } else {
            alert('Error al guardar el juguete');
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Error al guardar el juguete');
    }
};

// Búsqueda y filtrado
document.getElementById('toySearch').oninput = function(e) {
    const searchTerm = e.target.value.toLowerCase();
    const cards = document.querySelectorAll('.toy-card');
    
    cards.forEach(card => {
        const name = card.querySelector('h3').textContent.toLowerCase();
        const description = card.querySelector('.toy-description').textContent.toLowerCase();
        const matches = name.includes(searchTerm) || description.includes(searchTerm);
        card.style.display = matches ? 'block' : 'none';
    });
};

document.getElementById('categoryFilter').onchange = function(e) {
    const category = e.target.value;
    const cards = document.querySelectorAll('.toy-card');
    
    cards.forEach(card => {
        const toyCategory = card.querySelector('.toy-category').textContent;
        card.style.display = (category === 'all' || toyCategory === category) ? 'block' : 'none';
    });
};
</script>
{% endblock %}